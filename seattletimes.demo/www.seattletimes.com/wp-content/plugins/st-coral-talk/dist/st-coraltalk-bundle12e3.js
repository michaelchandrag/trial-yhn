(()=>{"use strict";function e(e,t){this.name="AggregateError",this.errors=e,this.message=t||""}e.prototype=Error.prototype;var t=setTimeout;function n(e){return Boolean(e&&void 0!==e.length)}function o(){}function i(e){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],u(e,this)}function r(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,i._immediateFn((function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var o;try{o=n(e._value)}catch(e){return void c(t.promise,e)}s(t.promise,o)}else(1===e._state?s:c)(t.promise,e._value)}))):e._deferreds.push(t)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof i)return e._state=3,e._value=t,void a(e);if("function"==typeof n)return void u((o=n,r=t,function(){o.apply(r,arguments)}),e)}e._state=1,e._value=t,a(e)}catch(t){c(e,t)}var o,r}function c(e,t){e._state=2,e._value=t,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&i._immediateFn((function(){e._handled||i._unhandledRejectionFn(e._value)}));for(var t=0,n=e._deferreds.length;t<n;t++)r(e,e._deferreds[t]);e._deferreds=null}function l(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function u(e,t){var n=!1;try{e((function(e){n||(n=!0,s(t,e))}),(function(e){n||(n=!0,c(t,e))}))}catch(e){if(n)return;n=!0,c(t,e)}}i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var n=new this.constructor(o);return r(this,new l(e,t,n)),n},i.prototype.finally=function(e){var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){return t.reject(n)}))}))},i.all=function(e){return new i((function(t,o){if(!n(e))return o(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);var r=i.length;function s(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var c=n.then;if("function"==typeof c)return void c.call(n,(function(t){s(e,t)}),o)}i[e]=n,0==--r&&t(i)}catch(e){o(e)}}for(var c=0;c<i.length;c++)s(c,i[c])}))},i.any=function(t){var n=this;return new n((function(o,i){if(!t||void 0===t.length)return i(new TypeError("Promise.any accepts an array"));var r=Array.prototype.slice.call(t);if(0===r.length)return i();for(var s=[],c=0;c<r.length;c++)try{n.resolve(r[c]).then(o).catch((function(t){s.push(t),s.length===r.length&&i(new e(s,"All promises were rejected"))}))}catch(e){i(e)}}))},i.allSettled=function(e){return new this((function(t,n){if(!e||void 0===e.length)return n(new TypeError(typeof e+" "+e+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var o=Array.prototype.slice.call(e);if(0===o.length)return t([]);var i=o.length;function r(e,n){if(n&&("object"==typeof n||"function"==typeof n)){var s=n.then;if("function"==typeof s)return void s.call(n,(function(t){r(e,t)}),(function(n){o[e]={status:"rejected",reason:n},0==--i&&t(o)}))}o[e]={status:"fulfilled",value:n},0==--i&&t(o)}for(var s=0;s<o.length;s++)r(s,o[s])}))},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i((function(t){t(e)}))},i.reject=function(e){return new i((function(t,n){n(e)}))},i.race=function(e){return new i((function(t,o){if(!n(e))return o(new TypeError("Promise.race accepts an array"));for(var r=0,s=e.length;r<s;r++)i.resolve(e[r]).then(t,o)}))},i._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};const m=i,d=e=>{let t=decodeURIComponent(document.cookie).split(";");for(let n=0;n<t.length;n++){let o=t[n].split("="),i=o[0].replace(/^\s+|\s+jQuery/g,""),r=o[1];if(i==e)return r}return!1},h=class{constructor(){void 0!==window.SEATIMESCO.comments&&window.SEATIMESCO.comments.enabled&&(this.commentHash="#comments",this.coralTokenName="coralTokenV6",this.sessionTokenName="sessionToken",this.showCommentsButton=document.querySelector(".article-comments-bar"),this.commentsContainer=document.querySelector(".comments-container"),this.subscribeLink=document.querySelector(".coral-subscribe-link"),this.subscribeLinkContainer=this.subscribeLink.parentElement,this.initialized=!1,this.subscribeLink&&this.subscribeLink.addEventListener("click",this.setStReturn),this.checkInitialSetup=this.checkInitialSetup.bind(this),this.shouldOpenCommentWidget=this.shouldOpenCommentWidget.bind(this),this.commentsHandler=this.commentsHandler.bind(this),this.showCommentsButton.addEventListener("click",this.commentsHandler))}checkInitialSetup(){const e=d(this.sessionTokenName),t=window.localStorage.getItem(this.sessionTokenName);if(e&&(()=>{const e=d("st_subscriberdata");return!(!e||!Array.isArray(JSON.parse(e)))})()){if(!window.localStorage.getItem(this.coralTokenName)||e!==t)return(n=(((window.SEATIMESCO||{}).singleSignOn||{}).info||{}).commenterSessionURL+e,fetch(n).then((e=>e.json()))).then((t=>{window.localStorage.setItem(this.coralTokenName,t.token),window.localStorage.setItem(this.sessionTokenName,e),this.shouldOpenCommentWidget()&&this.commentsHandler()})).catch((e=>{console.log("Could not create Talk token",e),window.localStorage.removeItem(this.sessionTokenName),window.localStorage.removeItem(this.coralTokenName),this.shouldOpenCommentWidget()&&this.commentsHandler()}));this.shouldOpenCommentWidget()&&this.commentsHandler()}else window.localStorage.removeItem(this.sessionTokenName),window.localStorage.removeItem(this.coralTokenName),this.shouldOpenCommentWidget()&&this.commentsHandler();var n}shouldOpenCommentWidget(){return!(window.location.hash!==this.commentHash&&!/[?&]commentID=/.test(window.location.search))}commentsHandler(){if(!this.initialized){const t=window.localStorage.getItem(this.coralTokenName);if(t||this.subscribeLinkContainer.classList.remove("hide"),void 0!==window.Coral&&void 0!==window.SEATIMESCO.comments){var e=window.Coral.createStreamEmbed({id:"coral_talk_stream",autoRender:!0,rootURL:window.SEATIMESCO.comments.coralURL,storyID:window.SEATIMESCO.comments.postID,storyURL:window.SEATIMESCO.comments.assetURL,accessToken:t,events:function(e){e.onAny((function(e,t){"createComment.success"===e?window.STEventManager.dataLayerEvent("analyticsEvent","commenting","comment posted",window.SEATIMESCO.comments.postID,null,!0):"createCommentReply.success"===e?window.STEventManager.dataLayerEvent("analyticsEvent","commenting","comment replied",window.SEATIMESCO.comments.postID,null,!0):"createCommentReaction.success"===e?window.STEventManager.dataLayerEvent("analyticsEvent","commenting","comment respected",window.SEATIMESCO.comments.postID,null,!0):"loginPrompt"===e&&(window.STEventManager.completedEvent("singleSignOn:handleReturnURL"),window.location.href="https://"+window.location.hostname+"/subscribe/signup-offers/?subsource=commenting")}))}});t||e.logout(),this.initialized=!0}}const t="comments "+(this.commentsContainer.classList.contains("active")?"closed":"opened");window.STEventManager.dataLayerEvent("analyticsEvent","commenting",t,null,null,!0),this.commentsContainer.classList.toggle("active"),this.showCommentsButton.classList.toggle("active")}setStReturn(){window.STEventManager.completedEvent("singleSignOn:handleReturnURL")}};class f{constructor(){window.Promise||(window.Promise=m),(new h).checkInitialSetup()}}"interactive"===document.readyState||"complete"===document.readyState?new f:document.addEventListener("DOMContentLoaded",(()=>{new f}))})();